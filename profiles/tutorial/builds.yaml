# TIP: To check your parameters before running, use: `snakemake -c 1 print_config`

# -----------------------------------------------------------------------------
# Inputs
# -----------------------------------------------------------------------------

# These are the datasets, actual files, you are providing as input.

# name                 : Builds will use this to specify the input
# type                 : can be any combination of local,usher
# metadata (local)     : path to metadata for local input
# sequences (local)    : path to sequences for local input
# pb_url (usher)       : url to protobuf for usher input
# metadata_url (usher) : url to metadata for usher input
# ver_url (usher)      : url to version info for usher input

inputs:

  # An UShER base phylogeny of all publicly available samples (genbank).
  # The protobuf will be downloaded to: `data/public-latest/usher.pb.gz
  # The metadata will be downloaded to: `data/public-latest/usher.metadata.tsv
  - name: public-latest
    type:
      - usher

    # Version controlled to 2022-04-17
    pb_url: http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/2022/04/17/public-2022-04-17.all.masked.pb.gz
    metadata_url: http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/2022/04/17/public-2022-04-17.metadata.tsv.gz
    ver_url: http://hgdownload.soe.ucsc.edu/goldenPath/wuhCor1/UShER_SARS-CoV-2/2022/04/17/public-2022-04-17.version.txt

  # Tutorial sequences and metadata
  - name: tutorial
    type:
      - local
    metadata: data/tutorial/metadata.tsv
    sequences: data/tutorial/sequences.fasta

# -----------------------------------------------------------------------------
# Builds
# -----------------------------------------------------------------------------

# These are the analyses, you want to run.

# name       : A directory will be created as results/{name}
# base_input : The base phylogeny for UShER, must be an input with type "usher"

builds:

  # ---------------------------------------------------------------------------
  # `tutorial` is a custom build, that uses a toy dataset

  - name: tutorial
    base_input: public-latest

    # Universal rule parameters can (optionally) be overridden for a specific build.
    usher_metadata:
      extra_cols: "date,country,gisaid_epi_isl,genbank_accession"

    report:
      cols: "nml_lab_id,strain,gisaid_epi_isl,usher_subtree,usher_pango_lineage_map,Nextclade_pango,sc2rf_clades_filter,date,division,sc2rf_breakpoints_regions_filter,purpose_of_sequencing,purpose_of_sequencing_details,border_sample"
      cols_rename: "nml_lab_id,ngs_id,gisaid_epi_isl,subtree,lineage_usher,lineage_nextclade,parents,date,division,breakpoints,purpose_of_sequencing,purpose_of_sequencing_details,border_sample"
      years: "2022,2021"
